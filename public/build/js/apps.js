document.addEventListener("DOMContentLoaded",()=>{console.log("✅ apps.js cargado correctamente");const e={es:{ui:{primaryTitle:"Aplicaciones de",primarySubtitle:"Desarrolladas por el equipo de",defaultCompany:"FUNIFELT",viewMore:"Ver más",knowMore:"Conoce más",loadingError:"Error al cargar el contenido.",noApps:"No se encontraron aplicaciones para esta empresa.",noAllied:"No se encontraron aplicaciones de aliados.",promoTitle:"Apoya la Misión Social de FUNIFELT",promoText:"Cada compra financia programas educativos para comunidades vulnerables. ¡Tu descarga hace la diferencia!"},banners:[{id:"static1",appName:"Aplicaciones Móviles",description:"FUNIFELT ha desarrollado cuatro aplicaciones diferentes para mejorar la competencia comunicativa en inglés, español, italiano y holandés. Se centran en los estudiantes autónomos. Aprenderán vocabulario nuevo y podrán escuchar cómo se pronuncia; esas aplicaciones tienen más de 78 niveles y juegos.",backgroundImageUrl:"/build/img/banners/banner-aplicaciones-moviles.png",linkUrl:"https://www.funifelt.com/languageapps",contentBackgroundColor:"#2c3e50",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#3498db",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static2",appName:"Escuelas & Colegios",description:"Contamos con programas escolares que ayudan a los estudiantes basados en programas curriculares nacionales e internacionales, generando un ambiente cálido de respeto y tolerancia con otras culturas enfocadas en el plurilingüismo. ¡Sé parte de nuestras escuelas!",backgroundImageUrl:"/build/img/banners/banner-escuelas-colegios.png",linkUrl:"https://www.funifelt.com/schools",contentBackgroundColor:"#8e44ad",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#9b59b6",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static3",appName:"Español para Extranjeros",description:"Ofrecemos lecciones individuales desde Principiantes hasta Avanzados a precios adecuados y apoyamos el proceso educativo y turístico de nuestros estudiantes que quieran estudiar y viajar a Latinoamérica o España. Nuestros alumnos cuentan con diversos materiales para las pruebas DELE y SIELE.",backgroundImageUrl:"/build/img/banners/banner-espanol-extranjeros.png",linkUrl:"https://www.funifelt.com/spanish-4-foreigners",contentBackgroundColor:"#c0392b",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#e74c3c",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static4",appName:"Donación",description:"Nuestra Fundación recibió libros donados por niños de EE.UU. Estos libros son cuentos infantiles como Mi pequeño pony, Frozen, etc. Esta donación ayuda a nuestros niños a disfrutar de la lectura y escritura con historias que conocen de la TV. ¡Sé parte de nuestro programa!",backgroundImageUrl:"/build/img/banners/banner-donacion.png",linkUrl:"https://www.facebook.com/revistaedu.co/photos/a.908086225882781.1073741828.906933325998071/1754255121265883/?type=3&theater",contentBackgroundColor:"#16a085",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#1abc9c",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static5",appName:"PNDE- 2016-2026",description:"FUNIFELT y el Ministerio de Educación Nacional presentan el Plan Decenal de Educación. Somos parte del Comité de Gestión y participamos en la presentación del Plan 2016-2026. Nos sentimos comprometidos con impulsar el camino hacia la calidad y la equidad.",backgroundImageUrl:"/build/img/banners/banner-pnde-colombia.png",linkUrl:"https://www.mineducacion.gov.co/portal/salaprensa/Noticias/363197:Colombia-ya-tiene-su-Plan-Nacional-Decenal-de-Educacion",contentBackgroundColor:"#2980b9",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#3498db",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"}]},en:{ui:{primaryTitle:"Apps by",primarySubtitle:"Developed by the team at",defaultCompany:"FUNIFELT",viewMore:"Read more",knowMore:"Learn more",loadingError:"Error loading content.",noApps:"No apps found for this company.",noAllied:"No allied apps found.",promoTitle:"Support FUNIFELT's Social Mission",promoText:"Every purchase funds educational programs for vulnerable communities. Your download makes a difference!"},banners:[{id:"static1",appName:"Mobile Applications",description:"FUNIFELT has developed four different applications to improve communicative competence in English, Spanish, Italian, and Dutch. Focused on autonomous learners, they teach new vocabulary and pronunciation with over 78 levels and games at the end of each level.",backgroundImageUrl:"/build/img/banners/banner-aplicaciones-moviles.png",linkUrl:"https://www.funifelt.com/languageapps",contentBackgroundColor:"#2c3e50",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#3498db",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static2",appName:"Schools & Colleges",description:"We have school programs that support students based on national and international curricular standards, creating a warm environment of respect and tolerance for other cultures focused on multilingualism. Be part of our schools!",backgroundImageUrl:"/build/img/banners/banner-escuelas-colegios.png",linkUrl:"https://www.funifelt.com/schools",contentBackgroundColor:"#8e44ad",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#9b59b6",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static3",appName:"Spanish for Foreigners",description:"We offer individual lessons from Beginners to Advanced at affordable prices, supporting the educational and tourism process of students wishing to study and travel in Latin America or Spain. Our students have access to various materials for DELE and SIELE exams.",backgroundImageUrl:"/build/img/banners/banner-espanol-extranjeros.png",linkUrl:"https://www.funifelt.com/spanish-4-foreigners",contentBackgroundColor:"#c0392b",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#e74c3c",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static4",appName:"Donation",description:"Our Foundation received books donated by children from the USA. These are children's stories like My Little Pony, Frozen, etc. This donation helps our children enjoy reading and writing through stories they recognize from TV. Be part of our program!",backgroundImageUrl:"/build/img/banners/banner-donacion.png",linkUrl:"https://www.facebook.com/revistaedu.co/photos/a.908086225882781.1073741828.906933325998071/1754255121265883/?type=3&theater",contentBackgroundColor:"#16a085",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#1abc9c",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"},{id:"static5",appName:"PNDE- 2016-2026",description:"FUNIFELT and the Ministry of National Education present the Decennial Education Plan. We are part of the Management Committee participating in the 2016-2026 plan presentation. We are committed to promoting 'the path towards quality and equity'.",backgroundImageUrl:"/build/img/banners/banner-pnde-colombia.png",linkUrl:"https://www.mineducacion.gov.co/portal/salaprensa/Noticias/363197:Colombia-ya-tiene-su-Plan-Nacional-Decenal-de-Educacion",contentBackgroundColor:"#2980b9",titleColor:"#ffffff",textColor:"#ecf0f1",buttonBgColor:"#3498db",buttonTextColor:"#ffffff",imageBackgroundColor:"#2a2a2a"}]}}[navigator.language.startsWith("es")?"es":"en"];const o={primaryAppsContainer:document.getElementById("funifeltApps"),alliedAppsContainer:document.getElementById("newApps"),sliderContainer:document.getElementById("appSlider"),promoContainer:document.getElementById("promoBanner"),primaryTitle:document.getElementById("primary-section-title"),primarySubtitle:document.getElementById("primary-section-subtitle"),alliedCompaniesLink:document.getElementById("allied-companies-link"),alliedCompaniesDropdown:document.getElementById("allied-companies-dropdown"),prevBtn:document.getElementById("prevBtn"),nextBtn:document.getElementById("nextBtn")};!async function(){o.sliderContainer&&(o.sliderContainer.innerHTML=e.banners.map((o,n)=>{const a=(n+1)%2==0,t=`\n                <div class="slider-item__image" style="background-color: ${o.imageBackgroundColor||"#2a2a2a"};">\n                    <img src="${o.backgroundImageUrl}" alt="Banner de ${o.appName}">\n                </div>`,r=`style="background-color: ${o.contentBackgroundColor||"#2a2a2a"};"`,i=`style="color: ${o.titleColor||"#ffffff"};"`,l=`style="color: ${o.textColor||"#dddddd"};"`,s=`style="background-color: ${o.buttonBgColor||"#26488C"}; color: ${o.buttonTextColor||"#FFFFFF"};"`,c=`\n                <div class="slider-item__content" ${r}>\n                    <h3 ${i}>${o.appName}</h3>\n                    <p ${l}>${o.description}</p>\n                    <a href="${o.linkUrl}" class="btn-promo" ${s}>${e.ui.viewMore}</a>\n                </div>`;return`\n            <div class="slider-item" data-id="${o.id}">\n                ${a?c+t:t+c}\n            </div>\n        `}).join("")),o.promoContainer&&(o.promoContainer.innerHTML=`\n            <div class="promo-content">\n                <h3>${e.ui.promoTitle}</h3>\n                <p>${e.ui.promoText}</p>\n                <a href="https://www.funifelt.com/" class="btn-promo-intercalado">${e.ui.knowMore}</a>\n            </div>\n            <div class="promo-image">\n              <img src="/build/img/banners/mision-social.png" alt="Misión Social Funifelt">\n            </div>\n        `),function(){if(!o.sliderContainer||!o.prevBtn||!o.nextBtn)return;const e=o.sliderContainer.querySelectorAll(".slider-item"),n=e.length;if(n<=1)return o.prevBtn.style.display="none",void(o.nextBtn.style.display="none");let a=0;o.sliderContainer.style.scrollBehavior="smooth";const t=e=>{a="next"===e?(a+1)%n:(a-1+n)%n,r()},r=()=>{const n=e[a].offsetLeft;o.sliderContainer.scrollTo({left:n})};let i=setInterval(()=>t("next"),5e3);const l=()=>{clearInterval(i),i=setInterval(()=>t("next"),5e3)};o.nextBtn.addEventListener("click",()=>{t("next"),l()}),o.prevBtn.addEventListener("click",()=>{t("prev"),l()})}();const n=await async function(){try{const o=await fetch("/api/apps");if(!o.ok)throw new Error(e.ui.loadingError);const n=await o.json(),a=n.flatMap(e=>(e.applications||[]).map(o=>({...o,company_id:e.company_id,company_name:e.company_name}))),t=new Map;return n.forEach(e=>{e.company_id&&t.set(String(e.company_id),{id:String(e.company_id),name:e.company_name||`Empresa ${e.company_id}`})}),t.has(String(1))||t.set(String(1),{id:String(1),name:"Funifelt"}),{apps:a,allCompanies:Array.from(t.values())}}catch(n){return console.error("Error crítico al obtener datos:",n),o.primaryAppsContainer&&(o.primaryAppsContainer.innerHTML=`<p class="no-results">${e.ui.loadingError}</p>`),null}}();if(!n)return;const{apps:a,allCompanies:t}=n,r=new URLSearchParams(window.location.search).get("company_id")||1;!function(n,a){const t=Number(a),r=n.filter(e=>Number(e.company_id)===t),i=n.filter(e=>Number(e.company_id)!==t),l=e=>{const o=function(e){if(!e)return"undefined";let o=e.toLowerCase();return o=o.replace(/\s/g,"_"),o=o.replace(/[^a-z0-9_-]/g,""),o||"undefined"}(e.company_name),n=e.image?`/build/img/apps/${o}/${e.image}`:"",a=`https://placehold.co/300x300/2c3e50/ffffff?text=${encodeURIComponent(e.app_name||"App")}`;return`\n          <div class="app-card" data-id="${e.id||e.app_id}">\n            <img src="${n}" alt="${e.name||e.app_name}" class="app-icon" onerror="this.onerror=null; this.src='${a}';">\n            <h4 class="app-name">${e.name||e.app_name}</h4>\n          </div>`};o.primaryAppsContainer&&(o.primaryAppsContainer.innerHTML=r.length?r.map(l).join(""):`<p class="no-results">${e.ui.noApps}</p>`),o.alliedAppsContainer&&(o.alliedAppsContainer.innerHTML=i.length?i.map(l).join(""):`<p class="no-results">${e.ui.noAllied}</p>`)}(a,r),function(n,a){const t=a.find(e=>String(e.id)===String(n)),r=t?t.name:e.ui.defaultCompany;o.primaryTitle&&(o.primaryTitle.textContent=`${e.ui.primaryTitle} ${r}`),o.primarySubtitle&&(o.primarySubtitle.textContent=`${e.ui.primarySubtitle} ${r}.`)}(r,t),document.querySelectorAll(".app-gallery").forEach(e=>{e.addEventListener("click",e=>{const o=e.target.closest(".app-card");o&&o.dataset.id&&(window.location.href=`/app_detail?id=${o.dataset.id}`)})}),console.log("✨ Página de apps inicializada correctamente.")}()});