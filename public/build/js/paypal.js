document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("paypal-button-container"),t=document.getElementById("btn-shop");if(!e)return;t.addEventListener("click",()=>{t.style.display="none",e.style.display="block"});const a=e.dataset.price,n=e.dataset.name,r=e.dataset.id,o=e.dataset.user;paypal.Buttons({createOrder:function(e,t){return t.order.create({purchase_units:[{amount:{value:a},description:`Compra de la app ${n}`}]})},onApprove:function(e,t){t.order.capture().then(function(t){const a=t.payer.email_address,n=t.purchase_units[0].payments.captures[0].amount.currency_code,d=t.purchase_units[0].payments.captures[0].amount.value;fetch("/api/pays",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e.orderID,payer_id:e.payerID,app_id:r,user_id:o,payer_email:a,amount:d,currency:n})}).then(e=>e.json()).then(e=>{e.success?window.location.reload():alert("Error registrando el pago.")})})}}).render("#paypal-button-container")});